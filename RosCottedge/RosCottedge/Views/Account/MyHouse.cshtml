@model RosCottedge.ViewModels.MyHouseViewModel
@using RosCottedge.Models;
@using Webdiyer.WebControls.Mvc

@{
    ViewBag.Title = "MyHouse";
}
@Html.Partial("Profile")



<div class="container">
    @*<div class="messageUser">
        @if (TempData["create"] != null)
        {
            <div>@TempData["create"]</div>
        }
    </div>*@
    <div class="row">
        <div class="col-md-8" id="houses">
            
            @foreach (var item in Model.House)
            {
                <div class="houseWrap">
                    <p class="errorDelHouse" style="display: none;">Дом уже забронирован, его удаление невозможно</p>
                    <div class="houseContainer mainBox">
                        <div class="houseContainerHead">
                            <h3>@item.Name</h3>
                        </div>
                        <div class="houseBodyContainer">
                            <div class="houseBodyIMG" style="background-image: url(@item.Pictures.Where(x => x.HouseId == item.Id).Select(x => x.Adress).FirstOrDefault());"></div>
                            <div class="navHouseBody">
                                <div class="houseBodyRating"><span class="numberRating">@item.Rating</span></div>
                                <a href="/Account/EditMyHouse/@item.Id" class="remoteHouse"><p>Управление</p></a>
                                <a href="/House/Index?houseId=@item.Id"><p>Страница дома</p></a>
                                <div class="houseDelButton">
                                    @*@using (Html.BeginForm("DeleteHouse", "Account", FormMethod.Post, new { enctype = "multipart/form-data", id = "delHouse" }))
                                        {*@
                                    <form id="delHouse">
                                        <input type="hidden" value="@item.Id" name="id" /><br>
                                        <input class="closeInput" type="submit" value="" title="Удалить дом" />
                                    </form>
                                    @*}*@
                                </div>
                            </div>
                            @*<span class="close"></span>*@
                        </div>
                    </div>
                </div>
            }
            <div class="pagination-container">
                @Html.Pager(Model.House, new PagerOptions
                {
                    PageIndexParameterName = "page",
                    ContainerTagName = "ul",
                    CssClass = "pagination",
                    CurrentPagerItemTemplate = "<li class=\"active\"><a href=\"#\">{0}</a></li>",
                    DisabledPagerItemTemplate = "<li class=\"disabled\"><a>{0}</a></li>",
                    PagerItemTemplate = "<li>{0}</li>",
                    NextPageText = "<i class='mdi mdi-chevron-right'></i>",
                    PrevPageText = "<i class='mdi mdi-chevron-left'></i>",
                    LastPageText = "<i class='mdi mdi-chevron-double-right'></i>",
                    FirstPageText = "<i class='mdi mdi-chevron-double-left'></i>"
                })
            </div>
        </div>
        <div class="col-md-4 allNoticeMyHouse">

            @foreach (var item in Model.GeneralClass)
            {
                if (item.Reserv == true)
                {
                    <div class="classDelete">
                        <div class="noticeItem mainBox">
                            <div class="headerNotice noticeColorRed">
                                <p><span>@item.User.FirstName</span>, забронировал(а) дом "@item.House.Name"</p>
                            </div>

                        </div>
                        <div class="footerNotice">
                            <span>@item.Date.ToString("dd.MM.yyyy")</span>
                            <form id="DeleteReservationLandlord">
                                <input type="hidden" value="@item.HouseId" name="houseId" />
                                <input type="hidden" value="@item.Id" name="id" /><br>
                                <input class="subRemove1" type="button" value="Удалить" />
                            </form>
                        </div>
                    </div>



                }
                else if (item.Review == true)
                {
                    <div class="classDelete">
                        <div class="noticeItem mainBox">
                            <div class="headerNotice noticeColorGreen">
                                <p><span>@item.User.FirstName</span>, оставил(а) отзыв к дому "@item.House.Name"</p>
                            </div>

                        </div>
                        <div class="footerNotice">
                            <span>@item.Date.ToString("dd.MM.yyyy")</span>
                                <form id="DeleteReviews">
                                    <input type="hidden" value="@item.HouseId" name="houseId" />
                                    <input type="hidden" value="@item.Id" name="id" /><br>
                                    <input  class="subRemove2" type="button" value="Удалить" />
                                </form>
                                
                    </div>
                   </div>

                }
                else
                {
                    <div class="classDelete">
                        <div class="noticeItem mainBox">
                            <div class="headerNotice noticeColorBlue">
                                <p><span>@item.User.FirstName</span>, отменил(а) бронь "@item.House.Name"</p>
                            </div>

                        </div>
                        <div class="footerNotice">
                            <span>@item.Date.ToString("dd.MM.yyyy")</span>
                            <form id="DeleteReservationNotif">
                                <input type="hidden" value="@item.HouseId" name="houseId" />
                                <input type="hidden" value="@item.Id" name="id" /><br>
                                <input class="subRemove3" type="button" value="Удалить" />
                            </form>
                        </div>
                    </div>
                }


            }
        </div>

    </div>
</div>



@section Scripts {
    <script>
    $(document).ready(function () {
        var $c = $('.numberRating');
        if (parseInt($c.text()) != 0) {
            var c = parseFloat($c.text().replace(',', '.'));
            c = c.toFixed(1);
            $c.text(c);
        }
        //$('.houseDelButton').on('click', function () {
        //    $('#delHouse').submit();
        //});

        $('.subRemove1').parent('form').click(function () {
            var $DelResLan = $(this);
            $.getJSON("/Account/DeleteReservationLandlord", $(this).serialize(), function (data) {
                $DelResLan.parents('.classDelete').remove();
            });
            return false;
        });

        $('.subRemove2').parent('form').click(function () {
            var $DelResLan = $(this);
            $.getJSON("/Account/DeleteReviews", $(this).serialize(), function (data) {
                $DelResLan.parents('.classDelete').remove();
            });
            return false;
        });

        $('.subRemove3').parent('form').click(function () {
            var $DelResLan = $(this);
            $.getJSON("/Account/DeleteReservationNotif", $(this).serialize(), function (data) {
                $DelResLan.parents('.classDelete').remove();
            });
            return false;
        });
        $('.closeInput').parent('form').click(function () {
            var $DelResLan = $(this);
            $.getJSON("/Account/DeleteHouse", $(this).serialize(), function (data) {
                if (data == true)
                    $DelResLan.parents('.houseWrap').remove();
                else $DelResLan.parents('.houseWrap').children('.errorDelHouse').css('display', 'block');
            });
            return false;
        });
        $('.errorDelHouse').click(function () {
            $(this).css('display', 'none');
        });
    });
    </script>
}