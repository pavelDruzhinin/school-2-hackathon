@using RosCottedge.Models
@using Webdiyer.WebControls.Mvc

@model RosCottedge.ViewModels.HouseIndexViewModel
@{
    ViewBag.Title = "house";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container">
    <h2 class="briefDescription">@Model.House.Name</h2>
    <div class="row">
        <div class="col-md-8 col-sm-12 col-xs-12">

            <div class="slider">
                <div class="sliderHead">
                    <i class="fa fa-map-marker" aria-hidden="true"></i>
                    <h3><span id="Country" style="display:none;">Россия</span><span id="Region">@Model.House.Region</span>, <span id="City">@Model.House.Locality</span>, <span id="Street">@Model.House.Area</span>, <span id="House">@Model.House.HouseNumber</span></h3>
                    <div class="separate"></div>
                    <a id="SlideMap" href="#map_canvas_house">На карте</a>
                </div>
                <div class="owl-carousel">
                    @foreach (var p in Model.Pictures)
                    {
                        <div class="item" style="background-image: url(@p.Adress);"></div>
                    }
                </div>
                <div class="sliderFooter">
                    <div class="countUsersIcon"></div>
                    <p class="countUsers">@Model.House.NumberOfPersons</p>
                    <div class="separate"></div>
                    <p>@Model.House.Price руб. / сутки</p>
                    <div class="separate"></div>
                    <p id="totalCount">@Model.Reviews.TotalItemCount отзывов</p>
                    <div class="sliderRating">
                        <span id="textSliderRating">Нет оценки</span><div class="separate"></div><p id="numberSliderRating">@Model.House.Rating</p>
                    </div>
                </div>
            </div>
            <div class="fullDescription">
                <div class="descOwner">
                    <div class="leftSideOwner">
                        <div style="background-image: url(@Model.House.User.Avatar);"></div>
                        <h3>@Model.House.User.FirstName<br>@Model.House.User.LastName</h3>
                    </div>
                    <div class="rightSideOwner">
                        <p><span>На сайте:</span> с @Model.House.User.RegistrationDate</p>
                        <p><span>Телефон:</span> @Model.House.User.Phone</p>
                    </div>
                </div>
                <div class="descItems">
                    <h1>Описание</h1>
                    <p>@Model.House.Description</p>
                </div>
                <div class="descItems">
                    <h1>Питание</h1>
                    <p>@Model.House.Food</p>
                </div>
                <div class="descItems">
                    <h1>Трансфер</h1>
                    <p>@Model.House.Transfer</p>
                </div>
                <div class="descItems">
                    <h1>Услуги включенные в стоимость</h1>
                    <p>@Model.House.ServicesIncluded</p>
                </div>
                <div class="descItems">
                    <h1>Услуги за отдельныю плату</h1>
                    <p>@Model.House.AdditionalServices</p>
                </div>
                <div class="descItems">
                    <h1>Условия проживания</h1>
                    <p>@Model.House.Accomodations</p>
                </div>
                <div class="descItems">
                    <h1>Условия бронирования</h1>
                    <p>@Model.House.BookingConditions</p>
                </div>
            </div>

            <div id="map_canvas_house" class="mapBox"></div>
            <div id="MapAddressNotFound"><p>Google не может найти адрес дома, обратитесь к владельцу дома и сообщите ему об ошибке, спасибо!</p></div>
            <input type="hidden" id="LatId" value="@Model.House.lat" />
            <input type="hidden" id="LngId" value="@Model.House.lng" />

            @if (User.Identity.IsAuthenticated && Model.AllowComments)
            {
                <form class="formReview" id="formReviewId">
                    <input type="hidden" value="@Model.House.Id" name="HouseId">
                    <div class="formRowTop">
                        <div class="userLogo" style="background-image: url(@Model.User.Avatar);"></div>
                        <div class="wrapTexta">
                            <textarea name="Comment" id="comment" cols="30" rows="5" placeholder="Оставьте отзыв"></textarea>
                        </div>
                    </div>
                    <div class="formRowBottom">

                        <div class="formSelect mainRat">
                          <ul>
                            <li rating="1"></li>
                            <li rating="2"></li>
                            <li rating="3"></li>
                            <li rating="4"></li>
                            <li rating="5"></li>
                          </ul>
                            <select style="display: none;" name="Rating" id="selectRating"></select>
                        </div>
                        <div class="btnSendReviewWrap">
                            <button disabled class="btnSendReview" type="submit">Отправить</button>
                        </div>
                    </div>
                </form>
            }

            <div id="comments">
                @Html.Partial("_Comments", Model)
            </div>

        </div>

        <div class="col-md-4 col-md-offset-0 col-sm-8 col-sm-offset-2 col-xs-8 col-xs-offset-2">
            <form class="formReservation mainBox" id="reservation">
                <input type="hidden" value="@Model.House.Id" name="HouseId" />
                <input type="text" id="date1" class="date" name="ArrivalDate" placeholder="Заезд">
                <input type="text" id="date2" class="date secondDate" name="DepartureDate" placeholder="Выезд">
                <textarea name="Description" id="" cols="10" rows="10" placeholder="Подробнее"></textarea>
                <button type="submit" class="btnReservation">Забронировать</button>
            </form>
            <div class="errorBoxDate"></div>
        </div>
        <script>
            $(document).ready(function () {
                //Datepicker
                $.getJSON("/House/GetDates",{houseId : @Model.House.Id},function(data) {
                    function DisableSpecificDates(date) {
                        var string = $.datepicker.formatDate('dd-mm-yy', date);
                        var result = data.indexOf(string) == -1;
                        return [result,"",""];
                    }

                    $('.date').attr('readOnly', 'true');

                    var dates = $('#date1, #date2').datepicker({
                        dateFormat: 'dd-mm-yy',
                        monthNames: [
                            "Январь", "Февраль", "Март", "Апрель", "Май", "Июнь", "Июль", "Август",
                            "Сентябрь", "Октябрь", "Ноябрь", "Декабрь"
                        ],
                        dayNamesMin: ['ВС', 'ПН', 'ВТ', 'СР', 'ЧТ', 'ПТ', 'СБ'],
                        dateFormat: 'dd.mm.yy',
                        firstDay: 1,
                        minDate: '+1d',
                        maxDate: '+1y',
                        beforeShowDay: DisableSpecificDates,
                        onSelect: function (selectedDate) {
                            var option = this.id == "date1"  ? "minDate"  : "maxDate",
                            instance = $(this).data("datepicker"),
                            date = $.datepicker.parseDate(
                            instance.settings.dateFormat || $.datepicker._defaults.dateFormat,
                            selectedDate, instance.settings);
                            dates.not(this).datepicker("option", option, date);
                        }
                    });

                });
            });
        </script>
    </div>
</div>


@section scripts {
    @Scripts.Render("/Scripts/libs/autoresize.jquery/jquery.autosize.min.js")
    @Scripts.Render("/Scripts/libs/owl-carousel/js/owl.carousel.min.js")
    @Scripts.Render("/Scripts/config/House.js")
    <script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyDJZlsRr82NdMVjqUPb1fVy-t49lPdTgrw"></script>
    @{Html.RegisterMvcPagerScriptResource();}
}
